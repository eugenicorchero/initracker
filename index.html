<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Initiative Tracker - Creaci√≥n de Webs</title>
    <!-- Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ========================================== */
        /* PROFESSIONAL UI ENHANCEMENTS */
        /* ========================================== */
        
        /* Typography System */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            letter-spacing: -0.01em;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Glass-morphism Base */
        .glass-effect {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        /* Professional Card Shadows */
        .card-shadow {
            box-shadow: 
                0 1px 3px 0 rgba(0, 0, 0, 0.4),
                0 4px 6px -1px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(148, 163, 184, 0.05);
        }

        .card-shadow-lg {
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.5),
                0 10px 15px -3px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(148, 163, 184, 0.08);
        }

        /* Estilos de Turno Activo - Enhanced */
        .combatant-active {
            animation: activeGlow 2s ease-in-out infinite alternate;
            border: 3px solid #fbbf24;
            border-left: 6px solid #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(251, 146, 60, 0.08) 50%, rgba(30, 41, 59, 0.95) 100%);
            position: relative;
            transform: scale(1.02);
        }

        .combatant-active::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 1rem;
            padding: 3px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #fbbf24);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0.5;
            pointer-events: none;
        }

        @keyframes activeGlow {
            0% { 
                box-shadow: 
                    0 0 25px rgba(251, 191, 36, 0.7),
                    0 0 50px rgba(251, 191, 36, 0.4),
                    0 8px 16px -4px rgba(0, 0, 0, 0.6),
                    inset 0 2px 4px rgba(251, 191, 36, 0.2),
                    inset 0 -2px 4px rgba(251, 191, 36, 0.1);
            }
            100% { 
                box-shadow: 
                    0 0 35px rgba(251, 191, 36, 0.9),
                    0 0 70px rgba(251, 191, 36, 0.5),
                    0 12px 24px -6px rgba(0, 0, 0, 0.7),
                    inset 0 2px 4px rgba(251, 191, 36, 0.3),
                    inset 0 -2px 4px rgba(251, 191, 36, 0.15);
            }
        }

        /* Ocultar scrollbar */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Smooth scrolling for auto-scroll to active combatant */
        .scroll-smooth {
            scroll-behavior: smooth;
        }

        /* Better touch targets for mobile */
        @media (max-width: 768px) {
            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
            
            .mobile-compact {
                padding: 0.75rem;
            }
            
            .mobile-text-sm {
                font-size: 0.875rem;
            }
        }

        /* Button Enhancements */
        .btn-primary {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-primary:active::after {
            width: 300px;
            height: 300px;
        }

        /* Badge Enhancements */
        .badge {
            display: inline-flex;
            align-items: center;
            font-weight: 600;
            letter-spacing: 0.025em;
            transition: all 0.2s ease;
        }

        .badge:hover {
            transform: scale(1.05);
        }

        /* Theme System */
        .theme-light {
            --bg-primary: #f8fafc;
            --bg-secondary: #e2e8f0;
            --bg-tertiary: #cbd5e1;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-accent: #f59e0b;
            --border-color: #cbd5e1;
        }

        .theme-dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-accent: #fbbf24;
            --border-color: #475569;
        }

        /* Drag and drop styles */
        .dragging {
            opacity: 0.6;
            transform: scale(0.98) rotate(2deg);
            transition: all 0.2s ease;
        }

        .drag-over {
            border: 2px dashed #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.12) 0%, rgba(30, 41, 59, 0.95) 100%);
            transform: scale(1.02);
            transition: all 0.2s ease;
        }

        /* Enhanced animations */
        .slide-fade-enter-active, .slide-fade-leave-active {
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .slide-fade-enter-from {
            transform: translateX(-30px);
            opacity: 0;
        }
        .slide-fade-leave-to {
            transform: translateX(30px);
            opacity: 0;
        }

        /* Fade in animation for new elements */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        /* Pulse animation for important elements */
        @keyframes subtlePulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.9;
                transform: scale(1.02);
            }
        }

        .pulse-subtle {
            animation: subtlePulse 2s ease-in-out infinite;
        }

        /* Keyboard focus indicators */
        .focus-visible:focus {
            outline: 2px solid #fbbf24;
            outline-offset: 3px;
            border-radius: 0.5rem;
        }

        /* Better button hover effects */
        .btn-hover-lift {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.4);
        }

        .btn-hover-lift:active {
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Estilo para Tooltip flotante - Enhanced */
        .custom-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 10px;
            padding: 10px 14px;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: white;
            border-radius: 10px;
            font-size: 0.875rem;
            white-space: pre-wrap;
            min-width: 250px;
            max-width: 350px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 50;
            box-shadow: 
                0 10px 25px -5px rgba(0, 0, 0, 0.6),
                0 0 0 1px rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(148, 163, 184, 0.15);
        }

        .custom-tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1f2937;
        }

        .group:hover .custom-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }

        /* Estilo para Toast/Alerta de Mensaje */
        .toast-enter-active,
        .toast-leave-active {
            transition: all 0.5s ease;
        }

        .toast-enter-from,
        .toast-leave-to {
            opacity: 0;
            transform: translateY(20px);
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen font-sans">

    <div id="app" class="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">

        <!-- 
            ==============================================
            1. CABECERA: Control de Ronda y Turno
            ==============================================
        -->
        <header class="sticky top-0 z-10 glass-effect rounded-xl border border-gray-700/50 pb-3 mb-5 p-4 md:pb-4 md:mb-6 card-shadow-lg">
            <div class="flex flex-col space-y-3 md:flex-row md:justify-between md:items-center md:space-y-0">
                <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-500 bg-clip-text text-transparent text-center md:text-left tracking-tight">‚öîÔ∏è Tracker de Iniciativa D&D</h1>
                <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2 md:space-x-3 lg:space-x-4">
                    <span class="text-lg md:text-xl font-semibold tracking-wide">Ronda: <span class="text-yellow-400 font-bold">{{ round }}</span></span>
                    
                    <!-- Turn Timer Display -->
                    <div v-if="turnTimer.enabled" class="flex items-center space-x-2">
                        <span class="text-sm font-medium text-gray-300">Tiempo:</span>
                        <div class="flex items-center space-x-1 px-3 py-1.5 rounded-lg shadow-lg transition-all duration-300"
                            :class="{
                                'bg-gradient-to-r from-green-700 to-green-600': turnTimer.remaining > turnTimer.duration * 0.5,
                                'bg-gradient-to-r from-yellow-700 to-yellow-600': turnTimer.remaining <= turnTimer.duration * 0.5 && turnTimer.remaining > turnTimer.duration * 0.25,
                                'bg-gradient-to-r from-red-700 to-red-600 pulse-subtle': turnTimer.remaining <= turnTimer.duration * 0.25
                            }">
                            <span class="text-white font-mono text-sm font-semibold">{{ formatTime(turnTimer.remaining) }}</span>
                            <button @click="toggleTimer" class="text-xs hover:text-yellow-300 transition-colors duration-200">
                                {{ turnTimer.running ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è' }}
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-2 sm:gap-2 md:gap-3">
                        <button @click="nextTurn"
                            class="btn-primary btn-hover-lift touch-target px-4 sm:px-5 py-2.5 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 active:from-green-700 active:to-green-800 rounded-lg text-white font-semibold shadow-lg text-sm sm:text-base">
                            Siguiente Turno
                        </button>
                        <button @click="resetCombat"
                            class="btn-primary btn-hover-lift touch-target px-3 py-2.5 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 rounded-lg text-sm font-semibold shadow-lg">
                            Fin de Combate
                        </button>
                        <button @click="showDiceRoller"
                            class="touch-target px-3 py-2 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 rounded-lg text-sm transition duration-150 shadow-md">
                            üé≤ Dados
                        </button>
                        <button @click="showTimerSettings"
                            class="touch-target px-3 py-2 bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 rounded-lg text-sm transition duration-150 shadow-md btn-hover-lift">
                            ‚è±Ô∏è Timer
                        </button>
                        <button @click="toggleTheme"
                            class="touch-target px-3 py-2 bg-gray-600 hover:bg-gray-700 active:bg-gray-800 rounded-lg text-sm transition duration-150 shadow-md btn-hover-lift"
                            :title="isDarkTheme ? 'Cambiar a tema claro' : 'Cambiar a tema oscuro'">
                            {{ isDarkTheme ? '‚òÄÔ∏è' : 'üåô' }}
                        </button>
                        <button @click="showKeyboardShortcuts"
                            class="touch-target px-3 py-2 bg-gray-600 hover:bg-gray-700 active:bg-gray-800 rounded-lg text-sm transition duration-150 shadow-md btn-hover-lift">
                            ‚å®Ô∏è
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Mobile active combatant indicator -->
            <div v-if="combatants.length > 0" class="mt-3 md:hidden">
                <div class="bg-gray-800/80 rounded-lg p-2 text-center">
                    <span class="text-sm text-gray-400">Turno actual:</span>
                    <span class="ml-2 text-lg font-bold text-yellow-400">{{ sortedCombatants[activeCombatantIndex].name }}</span>
                </div>
            </div>
        </header>

        <!-- 
            ==============================================
            2. LAYOUT PRINCIPAL (Lista + Controles)
            ==============================================
        -->
    <main class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">

            <!-- Columna 1: Lista de Iniciativa -->
            <section id="combatant-list" class="lg:col-span-2 space-y-3 md:space-y-4 scroll-smooth">
                <h2 class="hidden md:block text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">
                    Turno: <span class="text-yellow-400 font-bold">{{ combatants.length ?
                        sortedCombatants[activeCombatantIndex].name : 'Nadie' }}</span>
                </h2>

                <div v-if="combatants.length === 0" class="text-center py-12 bg-gray-800 rounded-xl shadow-lg">
                    <p class="text-gray-400 text-xl">A√∫n no hay combatientes. ¬°A√±ade PJ's o Monstruos para empezar!</p>
                </div>

                <!-- Lista de Combatientes (v-for) with transitions -->
                <transition-group name="slide-fade" tag="div" class="space-y-4 md:space-y-6">
                    <div v-for="(c, index) in sortedCombatants" :key="c.id" :id="'combatant-' + c.id"
                    :class="{'combatant-active': index === activeCombatantIndex, 'dragging': c.isDragging, 'drag-over': c.isDragOver}"
                    class="fade-in bg-gradient-to-br from-gray-800 to-gray-850 p-4 rounded-2xl border border-gray-700/50 transition-all duration-300 cursor-move flex flex-col gap-3 w-full max-w-2xl mx-auto card-shadow hover:card-shadow-lg"
                    :data-index="index"
                    draggable="true"
                    @dragstart="startDrag($event, c)"
                    @dragend="endDrag($event, c)"
                    @dragover.prevent="dragOver($event, c)"
                    @dragleave="dragLeave($event, c)"
                    @drop="drop($event, c)">

                    <!-- 2.1 Info B√°sica (Nombre, CA, Iniciativa) -->
                    <div class="w-full md:col-span-3">
                        <div class="flex flex-col gap-2 items-start justify-start">
                            <span class="text-lg md:text-xl font-bold tracking-tight"
                                :class="{'text-blue-400': c.isPlayer, 'text-red-400': !c.isPlayer}">{{ c.name }}</span>
                            <span v-if="index === activeCombatantIndex" class="md:hidden bg-gradient-to-r from-yellow-500 to-yellow-600 text-gray-900 px-3 py-1 rounded-full text-xs font-bold shadow-md">
                                ‚ö° ACTIVO
                            </span>
                            <div class="flex gap-2 mt-1">
                                <span class="badge inline-block px-3 py-1.5 bg-gradient-to-br from-gray-700 to-gray-800 rounded-full text-sm font-semibold shadow-sm border border-gray-600/50">üõ°Ô∏è CA: {{ c.ac }}</span>
                                <span class="badge inline-block px-3 py-1.5 bg-gradient-to-br from-gray-700 to-gray-800 rounded-full text-sm font-semibold shadow-sm border border-gray-600/50">‚ö° Init: {{ c.initiative }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- 2.2 Control de HP (Barra de Vida) -->
                    <div class="w-full md:col-span-6">
                        <div class="flex flex-col gap-1 w-full">
                            <div class="flex items-center justify-between mb-1">
                                <span class="badge text-base font-bold py-1.5 px-4 uppercase rounded-full shadow-md"
                                    :class="hpColorClass(c)">
                                    ‚ù§Ô∏è HP: {{ c.currentHp }}{{ c.tempHp > 0 ? `+${c.tempHp}` : '' }} / {{ c.maxHp }}
                                </span>
                                <div v-if="c.currentHp === 0 && c.isPlayer" class="flex space-x-1">
                                    <button @click="rollDeathSave(c, true)" title="√âxito en salvaci√≥n de muerte"
                                        class="btn-primary px-2.5 py-1.5 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-full text-xs font-semibold shadow-md">
                                        ‚úì{{ c.deathSaves.successes }}
                                    </button>
                                    <button @click="rollDeathSave(c, false)" title="Fallo en salvaci√≥n de muerte"
                                        class="btn-primary px-2.5 py-1.5 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 rounded-full text-xs font-semibold shadow-md">
                                        ‚úó{{ c.deathSaves.failures }}
                                    </button>
                                </div>
                            </div>
                            <div class="overflow-hidden h-3.5 mb-4 text-xs flex rounded-full bg-gray-900 shadow-inner border border-gray-700/50">
                                <div :style="{ width: hpPercentage(c) + '%' }"
                                    class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center transition-all duration-500 relative"
                                    :class="hpBarClass(c)">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                                </div>
                                <div v-if="c.tempHp > 0" :style="{ width: tempHpPercentage(c) + '%' }"
                                    class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center transition-all duration-500 bg-gradient-to-r from-blue-400 to-blue-500 relative">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                                </div>
                            </div>
                            <!-- HP Controls Container -->
                            <div class="flex flex-wrap gap-3 md:gap-4 items-center justify-start glass-effect rounded-xl p-3 mt-2 w-full shadow-lg border border-gray-700/50">
                                <div class="flex flex-row gap-2 items-center w-full justify-start">
                                    <input type="number" v-model.number="c.damageInput" placeholder="Cantidad" min="1"
                                        class="touch-target w-16 p-2 rounded-lg bg-gray-900 text-center text-gray-100 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 font-semibold shadow-sm border border-gray-700" style="min-width:50px;max-width:80px;">
                                    <button @click="adjustHp(c, -c.damageInput)"
                                        :disabled="!c.damageInput || c.damageInput <= 0"
                                        class="btn-primary btn-hover-lift w-10 h-10 flex items-center justify-center bg-gradient-to-br from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 active:from-red-700 active:to-red-800 rounded-full text-lg font-bold disabled:opacity-50 shadow-md" aria-label="Restar HP (-)"
                                        title="Restar HP (-)">
                                        ‚àí
                                    </button>
                                    <button @click="adjustHp(c, c.damageInput)" :disabled="!c.damageInput || c.damageInput <= 0"
                                        class="btn-primary btn-hover-lift w-10 h-10 flex items-center justify-center bg-gradient-to-br from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 active:from-green-700 active:to-green-800 rounded-full text-lg font-bold disabled:opacity-50 shadow-md" aria-label="Sumar HP (+)"
                                        title="Sumar HP (+)">
                                        +
                                    </button>
                                    <button @click="adjustTempHp(c, c.damageInput)" :disabled="!c.damageInput || c.damageInput <= 0"
                                        class="btn-primary btn-hover-lift px-3 py-2 bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 active:from-blue-700 active:to-blue-800 rounded-full text-sm font-semibold disabled:opacity-50 shadow-md" aria-label="A√±adir HP Temporal"
                                        title="A√±adir HP Temporal">
                                        Temp
                                    </button>
                                    <button @click="undoHpChange(c)" :disabled="!c.hpHistory || c.hpHistory.length === 0"
                                        class="btn-primary btn-hover-lift px-3 py-2 bg-gradient-to-br from-yellow-600 to-yellow-700 hover:from-yellow-500 hover:to-yellow-600 active:from-yellow-700 active:to-yellow-800 rounded-full text-base font-semibold disabled:opacity-50 shadow-md" aria-label="Deshacer √∫ltimo cambio de HP"
                                        title="Deshacer √∫ltimo cambio de HP">
                                        ‚Ü∂
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2.3 Condiciones y Notas -->
                    <div class="w-full md:col-span-3 mt-2 md:mt-0 space-y-3">
                        <!-- FILA DE CONDICIONES -->
                        <div class="flex flex-wrap gap-2 items-center mt-2">
                            <!-- Iconos de Condiciones -->
                            <div v-for="cond in c.conditions" :key="cond.name + cond.id" 
                                class="relative group m-0.5 transition-all duration-200"
                                :class="{ 'pulse-subtle': cond.saveRequired }">
                                
                                <!-- Condition Icon with right-click menu -->
                                <div @click="removeCondition(c, cond.name)" @contextmenu.prevent="showConditionActions(c, cond)"
                                    class="cursor-pointer hover:scale-110 transition-all duration-200"
                                    title="Click: quitar | Click derecho: acciones">
                                    <span class="inline-block p-2 rounded-lg text-xs font-bold leading-none select-none shadow-md border transition-all duration-200"
                                        :class="{
                                            'bg-gradient-to-br from-red-600 to-red-700 text-white border-red-500/50': cond.name === 'Concentraci√≥n', 
                                            'bg-gradient-to-br from-yellow-500 to-yellow-600 text-gray-900 border-yellow-400/50': cond.name !== 'Concentraci√≥n',
                                            'bg-gradient-to-br from-orange-600 to-orange-700 text-white border-orange-500/50': cond.saveRequired,
                                            'bg-gradient-to-br from-purple-600 to-purple-700 text-white border-purple-500/50': cond.isCustom
                                        }">
                                        {{ cond.icon }}
                                        <span v-if="cond.duration && cond.duration !== '‚àû'"
                                            class="ml-0.5 text-sm font-extrabold">{{ (cond.tickTiming === 'round' ? 'r' : 't') + cond.duration }}</span>
                                        <span v-if="cond.saveRequired" class="ml-0.5 text-xs">üíæ</span>
                                    </span>
                                </div>

                                <!-- Tooltip customizado -->
                                <div class="custom-tooltip">
                                    <span class="font-bold block mb-1 text-base">
                                        {{ cond.name }} 
                                        <span v-if="cond.saveDC" class="text-sm">(CD {{ cond.saveDC }})</span>
                                        (Dur: <template v-if="cond.duration === '‚àû'">‚àû</template><template v-else>{{ cond.tickTiming === 'round' ? (cond.duration + ' rondas') : (cond.duration + ' turnos') }}</template>)
                                    </span>
                                    <p class="text-left text-gray-300">{{ getConditionTooltip(cond.name) }}</p>
                                    <div v-if="cond.saveRequired" class="mt-2 pt-2 border-t border-gray-600">
                                        <button @click="rollConditionSave(c, cond)" 
                                            class="px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs">
                                            Tirar Salvaci√≥n
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Bot√≥n para a√±adir condici√≥n -->
                            <button @click="showConditionModal(c)"
                                class="btn-primary btn-hover-lift p-2 rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white leading-none text-xl shadow-md border border-blue-500/50"
                                title="A√±adir Condici√≥n">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20"
                                    fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                                        clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>

                        <!-- NOTAS y BOT√ìN ELIMINAR -->
                        <div class="flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-2">
                            <div class="flex flex-row gap-2 w-full mt-1">
                                <input type="text" v-model="c.notes" @input="saveCombatants"
                                    placeholder="Notas (Ej: Carga, Bendecido, etc.)"
                                    class="touch-target flex-grow p-2 text-sm rounded-lg bg-gray-900 text-gray-100 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm border border-gray-700" style="min-width:60px;">
                                <button @click="removeCombatant(c.id)"
                                    class="btn-primary btn-hover-lift touch-target px-3 py-2 bg-gradient-to-br from-red-800 to-red-900 hover:from-red-700 hover:to-red-800 active:from-red-900 active:to-red-950 rounded-lg text-sm font-semibold shadow-md border border-red-700/50" style="min-width:50px;"
                                    title="Eliminar combatiente">
                                    Eliminar
                                </button>
                            </div>
                        </div>
                    </div>

                </transition-group>

            </section>

            <!-- Columna 2: Controles y DB de Condiciones -->
            <aside class="space-y-6 lg:col-span-1">

                <!-- 3. Formulario para A√±adir Combatiente -->
                <div class="glass-effect p-5 rounded-2xl card-shadow-lg space-y-4 border border-gray-700/50">
                    <h3 class="text-xl font-bold border-b border-gray-600/50 pb-3 mb-3 bg-gradient-to-r from-yellow-400 to-yellow-500 bg-clip-text text-transparent">‚ûï A√±adir Combatiente</h3>
                    <div class="flex flex-col gap-2">
                        <label for="combatant-name" class="block text-sm font-semibold text-gray-300">Nombre</label>
                        <input id="combatant-name" type="text" v-model="newCombatant.name"
                            placeholder="Ej: Kael (Guerrero) o Goblin 3"
                            class="w-full p-2.5 rounded-lg bg-gray-900 border border-gray-700 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm transition-all duration-200">
                    </div>
                    <div class="flex flex-row gap-2 mt-2">
                        <div class="flex flex-col gap-1 w-1/3">
                            <label for="combatant-init" class="block text-sm font-semibold text-gray-300">Iniciativa</label>
                            <div class="flex gap-2">
                                <input id="combatant-init" type="number" v-model.number="newCombatant.initiative"
                                    placeholder="10"
                                    class="w-full p-2.5 rounded-lg bg-gray-900 border border-gray-700 text-center focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm transition-all duration-200"
                                    min="0">
                                <button @click="rollInitiative" title="Tirar iniciativa (1d20)"
                                    class="btn-primary btn-hover-lift w-11 h-11 flex items-center justify-center bg-gradient-to-br from-yellow-500 to-yellow-600 hover:from-yellow-400 hover:to-yellow-500 rounded-lg text-lg font-bold shadow-md">
                                    üé≤
                                </button>
                            </div>
                        </div>
                        <div class="flex flex-col gap-1 w-1/3">
                            <label for="combatant-maxhp" class="block text-sm font-semibold text-gray-300">HP M√°x.</label>
                            <input id="combatant-maxhp" type="number" v-model.number="newCombatant.maxHp"
                                placeholder="35"
                                class="w-full p-2.5 rounded-lg bg-gray-900 border border-gray-700 text-center focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm transition-all duration-200"
                                min="1">
                        </div>
                        <div class="flex flex-col gap-1 w-1/3">
                            <label for="combatant-ac" class="block text-sm font-semibold text-gray-300">CA</label>
                            <input id="combatant-ac" type="number" v-model.number="newCombatant.ac" placeholder="15"
                                class="w-full p-2.5 rounded-lg bg-gray-900 border border-gray-700 text-center focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 shadow-sm transition-all duration-200"
                                min="0">
                        </div>
                    </div>
                    <div class="flex items-center gap-2 pt-2">
                        <input type="checkbox" id="isPlayerCheckbox" v-model="newCombatant.isPlayer"
                            class="h-5 w-5 rounded text-blue-500 bg-gray-900 border-gray-600 focus:ring-2 focus:ring-blue-500 cursor-pointer">
                        <label for="isPlayerCheckbox" class="text-gray-300 select-none font-medium cursor-pointer">¬øEs un Jugador?</label>
                    </div>
                    <button @click="addCombatant"
                        :disabled="!newCombatant.name || !newCombatant.maxHp || newCombatant.maxHp <= 0"
                        class="btn-primary btn-hover-lift w-full mt-4 p-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-lg font-bold text-base shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                        A√±adir a la Batalla
                    </div>
                </div>

                <!-- 4. Base de Datos de Condiciones (Submen√∫/Acorde√≥n) -->
                <div class="glass-effect p-5 rounded-2xl card-shadow-lg border border-gray-700/50">
                    <div class="flex justify-between items-center mb-3">
                        <button @click="toggleConditionMenu"
                            class="flex items-center text-xl font-bold border-b border-gray-600/50 pb-3 hover:text-yellow-400 transition-all duration-200">
                            üìö Base de Condiciones
                            <span class="text-yellow-400 text-2xl font-bold transition-transform duration-300 ml-2"
                                :class="{'rotate-180': isConditionMenuOpen}">{{ isConditionMenuOpen ? '‚ñº' : '‚ñ∫' }}</span>
                        </button>
                        <button @click="showCustomConditionModal"
                            class="px-3 py-1 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-semibold transition duration-150">
                            + Custom
                        </button>
                    </div>

                    <!-- Contenido del Submen√∫ (se muestra/oculta completamente) -->
                    <div v-if="isConditionMenuOpen" class="space-y-3 pt-2 max-h-96 overflow-y-auto hide-scrollbar">
                        <div v-for="cond in conditionDB" :key="cond.name" class="p-2 bg-gray-700 rounded-lg shadow-sm">
                            <span class="font-bold block text-base">{{ cond.icon }} {{ cond.name }}</span>
                            <p class="pt-1 text-sm text-gray-300">{{ cond.description }}</p>
                        </div>
                    </div>
                </div>

                <!-- 5. Importar/Exportar -->
                <div class="bg-gray-800 p-4 rounded-xl shadow-xl space-y-3">
                    <h3 class="text-xl font-semibold border-b border-gray-700 pb-2 mb-3">üì• Exportar / üì§ Importar</h3>
                    <button @click="exportCombatants"
                        class="w-full p-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg font-semibold transition duration-150 shadow-md">
                        Exportar Lista (JSON)
                    </button>
                    <input type="file" @change="importCombatants" accept=".json"
                        class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-gray-300 hover:file:bg-gray-600">
                    <p class="text-xs text-gray-500 pt-2">Los datos se guardan en tu navegador, usa esto para compartir
                        o hacer copias de seguridad.</p>
                </div>

            </aside>
        </main>

        <!-- 
            ==============================================
            MODAL DE A√ëADIR CONDICI√ìN
            ==============================================
        -->
        <div v-if="isConditionModalOpen"
            class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 p-6 rounded-xl w-full max-w-md shadow-2xl">
                <h3 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">A√±adir Condici√≥n a {{
                    selectedCombatant ? selectedCombatant.name : '' }}</h3>

                <div class="space-y-3 max-h-96 overflow-y-auto hide-scrollbar">
                    <div v-for="cond in conditionDB" :key="cond.name"
                        class="p-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition duration-150">
                        <div class="flex justify-between items-start">
                            <div class="flex-grow">
                                <span class="font-bold block text-lg">{{ cond.icon }} {{ cond.name }}</span>
                                <p class="text-xs text-gray-400 mt-1">{{ cond.description }}</p>
                            </div>
                            <button @click="applyCondition(cond)"
                                class="ml-4 px-3 py-1 bg-blue-500 hover:bg-blue-600 rounded-full text-sm font-semibold flex-shrink-0">
                                Aplicar
                            </button>
                        </div>

                        <!-- Duraci√≥n solo para condiciones no permanentes (y no Concentraci√≥n) -->
                        <div v-if="cond.name !== 'Concentraci√≥n'"
                            class="flex items-center mt-2 space-x-2 border-t border-gray-600 pt-2">
                            <label :for="'dur-' + cond.name" class="text-sm text-gray-300">Duraci√≥n (Turnos):</label>
                            <input :id="'dur-' + cond.name" type="number" min="1" v-model.number="cond.customDuration"
                                placeholder="1" class="w-16 p-1 text-sm rounded bg-gray-800 text-center">
                            <div class="flex items-center gap-2 ml-2">
                                <label class="text-sm text-gray-300">Tic:</label>
                                <select v-model="cond.tickTiming" class="bg-gray-800 text-gray-100 text-sm rounded p-1">
                                    <option value="turn">Inicio de su turno</option>
                                    <option value="round">Inicio de la ronda</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <button @click="isConditionModalOpen = false"
                        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold">Cerrar</button>
                </div>
            </div>
        </div>

        <!-- 
            ==============================================
            MODAL DE TIRADA DE DADOS
            ==============================================
        -->
        <div v-if="isDiceRollerOpen"
            class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 p-6 rounded-xl w-full max-w-lg shadow-2xl">
                <h3 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">üé≤ Tirador de Dados</h3>

                <!-- Quick Roll Buttons -->
                <div class="grid grid-cols-3 sm:grid-cols-4 gap-2 mb-4">
                    <button v-for="die in quickDice" :key="die.sides" 
                        @click="rollQuickDice(die.sides, die.label)"
                        class="p-3 bg-purple-600 hover:bg-purple-700 rounded-lg text-white font-bold transition duration-150 text-sm">
                        {{ die.label }}
                    </button>
                </div>

                <!-- Custom Roll Input -->
                <div class="space-y-3 mb-4">
                    <div class="flex space-x-2">
                        <input type="text" v-model="diceExpression" placeholder="Ej: 2d6+3, 1d20+5"
                            class="flex-grow p-2 rounded bg-gray-700 text-gray-100 focus:ring-purple-500 focus:border-purple-500">
                        <button @click="rollCustomDice"
                            class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition duration-150">
                            Tirar
                        </button>
                    </div>
                    <p class="text-xs text-gray-400">Ejemplos: 1d20+5, 2d6+3, 3d8, 1d4+2</p>
                </div>

                <!-- Roll Results -->
                <div v-if="diceResults.length > 0" class="mb-4 max-h-48 overflow-y-auto">
                    <h4 class="text-lg font-semibold mb-2">Resultados:</h4>
                    <div class="space-y-2">
                        <div v-for="(result, index) in diceResults.slice().reverse()" :key="index"
                            class="p-2 bg-gray-700 rounded-lg flex justify-between items-center">
                            <span class="text-sm">{{ result.expression }}</span>
                            <div class="text-right">
                                <div class="font-bold text-lg" :class="result.critical ? 'text-yellow-400' : 'text-green-400'">
                                    {{ result.total }}
                                </div>
                                <div class="text-xs text-gray-400">{{ result.details }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-between items-center">
                    <button @click="clearDiceResults"
                        class="px-3 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-sm">
                        Limpiar
                    </button>
                    <button @click="isDiceRollerOpen = false"
                        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>

        <!-- 
            ==============================================
            MODAL DE CONDICI√ìN PERSONALIZADA
            ==============================================
        -->
        <div v-if="isCustomConditionModalOpen"
            class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 p-6 rounded-xl w-full max-w-md shadow-2xl">
                <h3 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">‚ú® Crear Condici√≥n Personalizada</h3>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">Nombre</label>
                        <input type="text" v-model="customCondition.name" placeholder="Ej: Bendecido, Maldecido"
                            class="w-full p-2 rounded bg-gray-700 text-gray-100 focus:ring-purple-500 focus:border-purple-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">Icono/Emoji</label>
                        <input type="text" v-model="customCondition.icon" placeholder="üåü ‚ö° üî• ‚ùÑÔ∏è etc."
                            class="w-full p-2 rounded bg-gray-700 text-gray-100 focus:ring-purple-500 focus:border-purple-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">Descripci√≥n</label>
                        <textarea v-model="customCondition.description" placeholder="Describe el efecto de la condici√≥n..."
                            class="w-full p-2 rounded bg-gray-700 text-gray-100 focus:ring-purple-500 focus:border-purple-500 h-20 resize-none"></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Duraci√≥n (rondas)</label>
                            <input type="number" v-model.number="customCondition.duration" min="1" placeholder="1"
                                class="w-full p-2 rounded bg-gray-700 text-gray-100 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">CD de Salvaci√≥n</label>
                            <input type="number" v-model.number="customCondition.saveDC" min="1" placeholder="15"
                                class="w-full p-2 rounded bg-gray-700 text-gray-100 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                    </div>

                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="requiresSave" v-model="customCondition.saveRequired"
                            class="h-4 w-4 rounded text-purple-500 bg-gray-700 border-gray-600 focus:ring-purple-500">
                        <label for="requiresSave" class="text-gray-300 select-none">Requiere tirada de salvaci√≥n cada turno</label>
                    </div>
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <button @click="isCustomConditionModalOpen = false"
                        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold">Cancelar</button>
                    <button @click="createCustomCondition"
                        :disabled="!customCondition.name || !customCondition.icon"
                        class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold disabled:opacity-50">
                        Crear
                    </button>
                </div>
            </div>
        </div>

        <!-- 
            ==============================================
            MODAL DE CONFIGURACI√ìN DE TIMER
            ==============================================
        -->
        <div v-if="isTimerSettingsOpen"
            class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 p-6 rounded-xl w-full max-w-md shadow-2xl">
                <h3 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">‚è±Ô∏è Configuraci√≥n de Timer</h3>

                <div class="space-y-4">
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="enableTimer" v-model="turnTimer.enabled"
                            class="h-4 w-4 rounded text-indigo-500 bg-gray-700 border-gray-600 focus:ring-indigo-500">
                        <label for="enableTimer" class="text-gray-300 select-none">Habilitar timer de turno</label>
                    </div>

                    <div v-if="turnTimer.enabled">
                        <label class="block text-sm font-medium text-gray-300 mb-1">Duraci√≥n del turno (segundos)</label>
                        <div class="flex space-x-2">
                            <button v-for="preset in timerPresets" :key="preset.value"
                                @click="turnTimer.duration = preset.value"
                                :class="turnTimer.duration === preset.value ? 'bg-indigo-600' : 'bg-gray-600'"
                                class="px-3 py-2 rounded-lg text-sm font-medium hover:bg-indigo-700 transition duration-150">
                                {{ preset.label }}
                            </button>
                        </div>
                        <input type="number" v-model.number="turnTimer.duration" min="10" max="600" 
                            class="w-full mt-2 p-2 rounded bg-gray-700 text-gray-100 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>

                    <div v-if="turnTimer.enabled" class="flex items-center space-x-2">
                        <input type="checkbox" id="autoAdvance" v-model="turnTimer.autoAdvance"
                            class="h-4 w-4 rounded text-indigo-500 bg-gray-700 border-gray-600 focus:ring-indigo-500">
                        <label for="autoAdvance" class="text-gray-300 select-none">Avanzar turno autom√°ticamente</label>
                    </div>

                    <div v-if="turnTimer.enabled" class="flex items-center space-x-2">
                        <input type="checkbox" id="soundAlerts" v-model="turnTimer.soundAlerts"
                            class="h-4 w-4 rounded text-indigo-500 bg-gray-700 border-gray-600 focus:ring-indigo-500">
                        <label for="soundAlerts" class="text-gray-300 select-none">Alertas sonoras</label>
                    </div>
                </div>

                <!-- Combat Speed Analytics -->
                <div v-if="combatStats.totalTurns > 0" class="mt-6 pt-4 border-t border-gray-700">
                    <h4 class="text-lg font-semibold mb-2">üìä Estad√≠sticas de Combate</h4>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="bg-gray-700 p-2 rounded">
                            <div class="text-gray-400">Turnos totales</div>
                            <div class="font-bold">{{ combatStats.totalTurns }}</div>
                        </div>
                        <div class="bg-gray-700 p-2 rounded">
                            <div class="text-gray-400">Tiempo promedio</div>
                            <div class="font-bold">{{ formatTime(combatStats.averageTime) }}</div>
                        </div>
                        <div class="bg-gray-700 p-2 rounded">
                            <div class="text-gray-400">Turno m√°s r√°pido</div>
                            <div class="font-bold">{{ formatTime(combatStats.fastestTurn) }}</div>
                        </div>
                        <div class="bg-gray-700 p-2 rounded">
                            <div class="text-gray-400">Turno m√°s lento</div>
                            <div class="font-bold">{{ formatTime(combatStats.slowestTurn) }}</div>
                        </div>
                    </div>
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <button @click="resetCombatStats"
                        class="px-3 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm">
                        Reset Stats
                    </button>
                    <button @click="isTimerSettingsOpen = false"
                        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>

        <!-- 
            ==============================================
            MODAL DE ATAJOS DE TECLADO
            ==============================================
        -->
        <div v-if="isKeyboardShortcutsOpen"
            class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 p-6 rounded-xl w-full max-w-lg shadow-2xl">
                <h3 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">‚å®Ô∏è Atajos de Teclado</h3>

                <div class="space-y-3 max-h-96 overflow-y-auto">
                    <div v-for="shortcut in keyboardShortcuts" :key="shortcut.key"
                        class="flex justify-between items-center p-2 bg-gray-700 rounded-lg">
                        <span class="text-gray-300">{{ shortcut.description }}</span>
                        <div class="flex space-x-1">
                            <kbd v-for="key in shortcut.keys" :key="key"
                                class="px-2 py-1 bg-gray-600 rounded text-xs font-mono border border-gray-500">
                                {{ key }}
                            </kbd>
                        </div>
                    </div>
                </div>

                <div class="mt-6 flex justify-end">
                    <button @click="isKeyboardShortcutsOpen = false"
                        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>

        <!-- 
            ==============================================
            MODAL DE IMPORTAR COMBATIENTES
            ==============================================
        -->
        <div v-if="isImportModalOpen"
            class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 p-6 rounded-xl w-full max-w-2xl shadow-2xl max-h-[90vh] flex flex-col">
                <h3 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">üì§ Importar Combatientes</h3>
                
                <p class="text-sm text-gray-400 mb-4">Selecciona los combatientes que quieres a√±adir y ajusta su iniciativa:</p>
                
                <!-- List of combatants to import -->
                <div class="space-y-2 overflow-y-auto flex-grow mb-4">
                    <div v-for="(c, index) in importPreview" :key="index"
                        @click="c.selected = !c.selected"
                        class="p-3 rounded-lg cursor-pointer transition duration-150 flex items-center gap-3"
                        :class="c.selected ? 'bg-blue-700 hover:bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'">
                        
                        <!-- Checkbox visual -->
                        <div class="flex-shrink-0">
                            <div class="w-6 h-6 rounded border-2 flex items-center justify-center"
                                :class="c.selected ? 'bg-blue-500 border-blue-500' : 'bg-gray-600 border-gray-500'">
                                <svg v-if="c.selected" class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                        </div>
                        
                        <!-- Combatant info -->
                        <div class="flex-grow">
                            <div class="font-bold" :class="c.isPlayer ? 'text-blue-300' : 'text-red-300'">
                                {{ c.name }}
                            </div>
                            <div class="text-xs text-gray-400">
                                HP: {{ c.maxHp }} | CA: {{ c.ac }}
                            </div>
                        </div>
                        
                        <!-- Initiative input -->
                        <div class="flex items-center gap-2" @click.stop>
                            <label class="text-sm text-gray-300">Init:</label>
                            <input type="number" v-model.number="c.editableInitiative" 
                                class="w-16 p-1 rounded bg-gray-900 text-center text-gray-100 focus:ring-yellow-500 focus:border-yellow-500"
                                min="0"
                                @click.stop>
                            <button @click.stop="c.editableInitiative = Math.floor(Math.random() * 20) + 1" 
                                title="Tirar 1d20"
                                class="w-8 h-8 flex items-center justify-center bg-yellow-500 hover:bg-yellow-600 rounded text-sm font-bold transition duration-150">
                                üé≤
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="flex justify-between items-center pt-4 border-t border-gray-700">
                    <div class="text-sm text-gray-400">
                        {{ importPreview.filter(c => c.selected).length }} de {{ importPreview.length }} seleccionados
                    </div>
                    <div class="flex gap-3">
                        <button @click="cancelImport"
                            class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold">
                            Cancelar
                        </button>
                        <button @click="confirmImport"
                            :disabled="importPreview.filter(c => c.selected).length === 0"
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold disabled:opacity-50">
                            Importar Seleccionados
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 
            ==============================================
            POPUP: CONFIRMAR CONDICI√ìN EXPIRADA
            ==============================================
        -->
        <div v-if="expiringConditionPopup && expiringConditionPopup.isVisible"
            class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 p-5 rounded-xl w-full max-w-sm shadow-2xl border border-yellow-500">
                <h3 class="text-xl font-semibold mb-2 text-yellow-300">Condici√≥n expirada</h3>
                <p class="text-gray-100 mb-4">
                    ¬øLa condici√≥n <span class="font-bold">{{ expiringConditionPopup.condition?.name }}</span> en
                    <span class="font-bold">{{ expiringConditionPopup.combatant?.name }}</span> ha terminado?
                </p>
                <div class="flex justify-end gap-2">
                    <button @click="handleExpiringCondition(true)"
                        class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold">S√≠, eliminar</button>
                    <button @click="handleExpiringCondition(false)"
                        class="px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold">No, mantener</button>
                </div>
            </div>
        </div>

        <!-- 
            ==============================================
            TOAST / ALERTA DE MENSAJE (CENTRADO EN PANTALLA)
            ==============================================
        -->
        <transition name="toast">
            <div v-if="messageToast.isVisible" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
                        p-4 rounded-xl shadow-2xl z-[100] text-center max-w-md 
                        border-4"
                :class="messageToast.type === 'error' ? 'bg-red-800 border-red-600' : 'bg-yellow-600 border-yellow-400 text-gray-900'">
                <p class="font-bold text-xl mb-2">{{ messageToast.title }}</p>
                <p class="text-base">{{ messageToast.message }}</p>
                <button v-if="messageToast.type === 'error'" @click="messageToast.isVisible = false"
                    class="mt-3 text-sm font-semibold text-red-200 hover:text-white">
                    Entendido
                </button>
            </div>
        </transition>

    </div>

    <!-- =============================
         FOOTER
    ============================== -->
    <footer class="mt-12 mb-2 w-full flex flex-col items-center justify-center text-center text-gray-400 text-sm opacity-90 select-none">
        <div class="w-full max-w-3xl px-4 py-6 glass-effect rounded-xl card-shadow border border-gray-700/40">
            <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-2">
                <span>&copy; 2025 Eugeni Corchero. Todos los derechos reservados.</span>
                <span class="hidden md:inline-block">|</span>
                <span>
                    <a href="https://github.com/eugenicorchero/initracker" target="_blank" rel="noopener" class="text-yellow-400 hover:underline font-semibold">GitHub</a>
                    &middot; <span class="text-gray-500">v1.0</span>
                </span>
            </div>
            <div class="mt-2 text-xs text-gray-500">D&D Initiative Tracker es un proyecto personal sin √°nimo de lucro. No afiliado a Wizards of the Coast.</div>
        </div>
    </footer>
    <!-- ...existing code... -->
</body>

</html>